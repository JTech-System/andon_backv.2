"use strict";(self.webpackChunkandon_frontend=self.webpackChunkandon_frontend||[]).push([[300],{300:(K,M,r)=>{r.d(M,{I:()=>z});var d=r(5861),t=r(5879),s=r(5313),_=r(1476),p=r(9347),m=r(6223),y=r(7921),T=r(7398),S=r(7278);let C=(()=>{var n;class l{constructor(e){this.http=e}findAll(e){var a=this;return(0,d.Z)(function*(){return yield a.http.get(e)})()}removeRelation(e,a,i){var c=this;return(0,d.Z)(function*(){return yield c.http.delete(i(e),a)})()}addRelation(e,a,i){var c=this;return(0,d.Z)(function*(){return yield c.http.put(i(e),a)})()}}return(n=l).\u0275fac=function(e){return new(e||n)(t.LFG(S.v))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();var f=r(6814),v=r(4630),w=r(3680),h=r(5683),D=r(2032),x=r(2296),R=r(5940);function b(n,l){1&n&&t._UZ(0,"mat-spinner")}function N(n,l){if(1&n&&(t.TgZ(0,"div",6),t.YNc(1,b,1,0,"mat-spinner",5),t.qZA()),2&n){const o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.isLoadingResults)}}function U(n,l){if(1&n&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&n){const o=l.$implicit,e=t.oxw(3);t.Q6J("value",o[e.local_data.m2mData.rel_primary_col]),t.xp6(1),t.hij(" ",o[e.local_data.m2mData.rel_primary_col]," ")}}function J(n,l){if(1&n){const o=t.EpF();t.TgZ(0,"form",null,7)(2,"div",8)(3,"div",9)(4,"mat-label"),t._uU(5),t.qZA(),t.TgZ(6,"mat-form-field",10),t._UZ(7,"input",11),t.TgZ(8,"mat-autocomplete",null,12),t.YNc(10,U,2,2,"mat-option",13),t.ALo(11,"async"),t.qZA()()()(),t.TgZ(12,"button",14),t.NdJ("click",function(){t.CHM(o);const a=t.oxw(2);return t.KtG(a.doAdd())}),t._uU(13," Agregar "),t.qZA(),t.TgZ(14,"button",15),t.NdJ("click",function(){t.CHM(o);const a=t.oxw(2);return t.KtG(a.closeDialog())}),t._uU(15," Cancelar "),t.qZA()()}if(2&n){const o=t.MAs(1),e=t.MAs(9),a=t.oxw(2);t.xp6(5),t.Oqu(a.local_data.m2mData.title),t.xp6(2),t.Q6J("formControl",a.filterControl)("matAutocomplete",e),t.xp6(3),t.Q6J("ngForOf",t.lcZ(11,5,a.searchfilteredOptions)),t.xp6(2),t.Q6J("disabled",!o.valid)}}function Y(n,l){if(1&n&&(t.TgZ(0,"mat-dialog-content",3),t.YNc(1,N,2,1,"div",4),t.YNc(2,J,16,7,"form",5),t.qZA()),2&n){const o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.isLoadingResults),t.xp6(1),t.Q6J("ngIf",!o.isLoadingResults)}}function I(n,l){if(1&n){const o=t.EpF();t.TgZ(0,"div",17)(1,"p"),t._uU(2," Desea eliminar este registro"),t.TgZ(3,"span",18),t._uU(4),t.qZA(),t._uU(5," ? "),t.qZA()(),t.TgZ(6,"div",19)(7,"button",20),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.doDelete())}),t._uU(8," Eliminar "),t.qZA(),t.TgZ(9,"button",21),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.closeDialog())}),t._uU(10,"Cancelar"),t.qZA()()}if(2&n){const o=t.oxw();t.xp6(4),t.Oqu(o.local_data.name)}}let O=(()=>{var n;class l{constructor(e,a,i){this.dialogRef=e,this.data=a,this.m2mService=i,this.filterControl=new m.NI(""),this.relation_endpoint="",this.searchoption=[],this.isLoadingResults=!0,this.local_data={...a},this.action=this.local_data.action,this.relation_endpoint=this.local_data.m2mData.relation_endpoint}doAdd(){const e=this.searchoption.findIndex(a=>a[this.local_data.m2mData.rel_primary_col]==this.filterControl.value);this.local_data.relation_id=this.searchoption[e].id,this.local_data.relation=this.filterControl.value,this.dialogRef.close({event:this.action,data:this.local_data})}doDelete(){this.searchoption.findIndex(a=>a[this.local_data.m2mData.rel_primary_col]==this.local_data.relation),this.local_data.relation_id=this.local_data.relation_id,this.local_data.relation=this.local_data.relation,this.dialogRef.close({event:this.action,data:this.local_data})}closeDialog(){this.dialogRef.close({event:"Cancel"})}ngOnInit(){var e=this;return(0,d.Z)(function*(){const a=yield e.m2mService.findAll(e.relation_endpoint);a&&(e.isLoadingResults=!1,e.searchoption=a),e.searchfilteredOptions=e.filterControl.valueChanges.pipe((0,y.O)(""),(0,T.U)(i=>e._searchfilter(i||"")))})()}_searchfilter(e){const a=e.toLowerCase();return this.searchoption.filter(i=>i[this.local_data.m2mData.rel_primary_col].toString().toLowerCase().includes(a))}}return(n=l).\u0275fac=function(e){return new(e||n)(t.Y36(p.so),t.Y36(p.WI,8),t.Y36(C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-dialog-content"]],decls:6,vars:3,consts:[["mat-dialog-title","",1,"f-w-500","m-b-24"],["style","max-width: 100wv",4,"ngIf","ngIfElse"],["elseTemplate",""],[2,"max-width","100wv"],["class","example-loading-shade",4,"ngIf"],[4,"ngIf"],[1,"example-loading-shade"],["userForm","ngForm"],[1,"row"],[1,"col-12"],["appearance","outline",1,"w-100"],["type","text","placeholder","Buscar","aria-label","Relation","matInput","",3,"formControl","matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","mat-flat-button","","color","primary",3,"disabled","click"],["mat-stroked-button","","color","warn",1,"m-l-8",3,"click"],[3,"value"],[1,"p-x-24","m-b-15"],[1,"f-w-600"],["mat-dialog-actions","",1,"p-x-24","p-b-24"],["mat-button","","mat-flat-button","","color","warn",3,"click"],["mat-button","",1,"m-l-8",3,"click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"h2",0)(1,"strong"),t._uU(2),t.qZA()(),t.YNc(3,Y,3,2,"mat-dialog-content",1),t.YNc(4,I,11,1,"ng-template",null,2,t.W1O)),2&e){const i=t.MAs(5);t.xp6(2),t.Oqu("Add"==a.action?"Agregar "+a.local_data.m2mData.titleSingle:"Eliminar"),t.xp6(1),t.Q6J("ngIf","Delete"!==a.action)("ngIfElse",i)}},dependencies:[f.sg,f.O5,v.XC,w.ey,v.ZL,h.KE,h.hX,D.Nt,x.lW,R.Ou,p.uh,p.xY,p.H8,m._Y,m.Fj,m.JJ,m.JL,m.F,m.oH,f.Ov],encapsulation:2}),l})();var Z=r(5195),k=r(617),A=r(3566);function F(n,l){if(1&n&&(t.TgZ(0,"th",20),t._uU(1),t.ALo(2,"titlecase"),t.qZA()),2&n){const o=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,o.m2mData.titleSingle)," ")}}function Q(n,l){if(1&n&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&n){const o=l.$implicit;t.xp6(1),t.hij(" ",o.relation," ")}}function E(n,l){1&n&&(t.TgZ(0,"th",22),t._uU(1," Acciones "),t.qZA())}function L(n,l){if(1&n){const o=t.EpF();t.TgZ(0,"td",23)(1,"a",24),t.NdJ("click",function(){const i=t.CHM(o).$implicit,c=t.oxw();return t.KtG(c.openDialog("Delete",i))}),t.TgZ(2,"mat-icon",25),t._uU(3,"delete"),t.qZA()()()}}function H(n,l){1&n&&t._UZ(0,"tr",26)}function G(n,l){1&n&&t._UZ(0,"tr",27)}const B=function(){return[5,10,20]};let z=(()=>{var n;class l{constructor(e,a,i){this.dialog=e,this.cdRef=a,this.m2mService=i,this.table=Object.create(null),this.m2mData={title:"Relations",titleSingle:"Relations",parent:"Relations",parent_table:"relations",relation:"Relations",rel_primary_col:"id",relation_endpoint:"",display_cols:["id"],updateRelationEndpoint:c=>"string",data:[]},this.relationshipChanged=new t.vpe,this.displayedColumns=["relation","action"],this.dataSource=new s.by(this.m2mData.data),this.paginator=Object.create(null),this.dataSource=new s.by(this.m2mData.data),this.m2mData.data.length>0&&(this.dataSource.data=this.m2mData.data)}ngAfterViewInit(){this.m2mData.data.length>0&&(this.dataSource=new s.by(this.m2mData.data)),this.dataSource.paginator=this.paginator}applyFilter(e){this.dataSource.filter=e.trim().toLowerCase()}openDialog(e,a){a.action=e,a.m2mData=this.m2mData,this.dialog.open(O,{data:a}).afterClosed().subscribe(c=>{"Add"===c.event?this.addRowData(c.data):"Delete"===c.event&&this.deleteRowData(c.data)})}addRowData(e){var a=this;return(0,d.Z)(function*(){let i={};if(!a.dataSource.data.some(u=>u.relation==e.relation)){a.dataSource.data.unshift({parent:a.m2mData.parent,relation:e.relation,relation_id:e.relation_id}),a.dataSource.data=[...a.dataSource.data];const u=a.dataSource.data.map(W=>W.relation_id);i[a.m2mData.relation]=u,a.cdRef.detectChanges(),a.emitRelationshipChange(u),yield a.m2mService.addRelation(a.m2mData.parent,i,a.m2mData.updateRelationEndpoint)}})()}deleteRowData(e){var a=this;return(0,d.Z)(function*(){let i={};const c=a.dataSource.data.findIndex(g=>g.relation===e.relation);i[a.m2mData.relation]=[a.dataSource.data[c].relation_id],yield a.m2mService.removeRelation(a.m2mData.parent,i,a.m2mData.updateRelationEndpoint),-1!==c&&(a.dataSource.data.splice(c,1),a.cdRef.detectChanges(),a.dataSource.data=a.dataSource.data.filter(g=>g.relation!==e.relation))})()}emitRelationshipChange(e){this.relationshipChanged.emit(e)}}return(n=l).\u0275fac=function(e){return new(e||n)(t.Y36(p.uw),t.Y36(t.sBO),t.Y36(C))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-m2m"]],viewQuery:function(e,a){if(1&e&&(t.Gf(s.BZ,7),t.Gf(_.NW,7)),2&e){let i;t.iGM(i=t.CRH())&&(a.table=i.first),t.iGM(i=t.CRH())&&(a.paginator=i.first)}},inputs:{m2mData:"m2mData"},outputs:{relationshipChanged:"relationshipChanged"},decls:25,vars:9,consts:[[1,"cardWithShadow"],[1,"p-24"],[1,"row","justify-content-between"],[1,"col-lg-4"],["appearance","outline",1,"w-100","hide-hint"],["matInput","",3,"placeholder","keyup"],["matSuffix",""],[1,"col-lg-4","d-flex","align-items-center","justify-content-end"],["type","button","mat-flat-button","","color","primary",3,"click"],[1,"table-responsive"],["mat-table","","matSort","","matSortActive","createdOn","matSortDisableClear","","matSortDirection","desc",1,"example-table",3,"dataSource"],["matColumnDef","relation"],["mat-header-cell","","mat-sort-header","","class","f-w-600 mat-subtitle-1 f-s-16",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["mat-header-cell","","class","f-s-16 f-w-600",4,"matHeaderCellDef"],["mat-cell","","class","action-link",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"pageSizeOptions","showFirstLastButtons","hidePageSize"],["mat-header-cell","","mat-sort-header","",1,"f-w-600","mat-subtitle-1","f-s-16"],["mat-cell",""],["mat-header-cell","",1,"f-s-16","f-w-600"],["mat-cell","",1,"action-link"],[1,"m-r-10","cursor-pointer",3,"click"],[1,"mat-18"],["mat-header-row",""],["mat-row",""]],template:function(e,a){1&e&&(t.TgZ(0,"mat-card",0)(1,"mat-card-content",1)(2,"div",2)(3,"div",3)(4,"mat-form-field",4)(5,"input",5),t.NdJ("keyup",function(c){return a.applyFilter(c.target.value)}),t.qZA(),t.TgZ(6,"mat-icon",6)(7,"mat-icon"),t._uU(8,"search"),t.qZA()()()(),t.TgZ(9,"div",7)(10,"button",8),t.NdJ("click",function(){return a.openDialog("Add",{})}),t._uU(11),t.qZA()()()()(),t.TgZ(12,"mat-card",0)(13,"mat-card-content",1)(14,"div",9)(15,"table",10),t.ynx(16,11),t.YNc(17,F,3,3,"th",12),t.YNc(18,Q,2,1,"td",13),t.BQk(),t.ynx(19,14),t.YNc(20,E,2,0,"th",15),t.YNc(21,L,4,0,"td",16),t.BQk(),t.YNc(22,H,1,0,"tr",17),t.YNc(23,G,1,0,"tr",18),t.qZA(),t._UZ(24,"mat-paginator",19),t.qZA()()()),2&e&&(t.xp6(5),t.MGl("placeholder","Buscar ",a.m2mData.title,""),t.xp6(6),t.hij(" Agregar ",a.m2mData.titleSingle," "),t.xp6(4),t.Q6J("dataSource",a.dataSource),t.xp6(7),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(1),t.Q6J("pageSizeOptions",t.DdM(8,B))("showFirstLastButtons",!1)("hidePageSize",!0))},dependencies:[h.KE,h.R9,D.Nt,Z.a8,Z.dn,x.lW,k.Hw,_.NW,A.YE,A.nU,s.BZ,s.fO,s.as,s.w1,s.Dz,s.nj,s.ge,s.ev,s.XQ,s.Gk,f.rS],styles:[".img-bg-m2m-icon[_ngcontent-%COMP%]{background-image:url(robots-03.2d3caddef6f94e3e.png);background-size:50px;background-repeat:no-repeat;background-position:left center;left:15px;position:absolute!important;min-height:150px;z-index:1000}"]}),l})()}}]);